<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>여행 스타일 선택</title>
  <style>
/**********************************************/
    body {
  margin: 0;
  font-family: 'Istok Web', sans-serif;
  background-color: #f0f0f0;
  display: flex;
  justify-content: center;   /* ✅ 가로는 가운데 */
  align-items: flex-start;   /* ✅ 세로는 위쪽 */
  min-height: 100vh;
}
/*******************************************/
    * {
      box-sizing: border-box;
    }

    .preferences-container {
      background-color: #ffffff;
      width: 100%;
      max-width: 393px;
      padding: 50px 16px;
      display: flex;
      flex-direction: column;
    }

    .main-title {
      font-weight: 700;
      font-size: 30px;
      line-height: 1.44;
      color: #000000;
      margin: 0 0 32px;
    }

    .form-section {
      margin-bottom: 24px;
    }

    .section-title {
      font-weight: 700;
      font-size: 18px;
      line-height: 1.5;
      letter-spacing: -0.18px;
      color: #000000;
      margin: 0 0 13px;
    }

    .tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 16px 10px;
    }

    .tag-button {
      background-color: #d9d9d9;
      border-radius: 40px;
      border: none;
      padding: 9px 18px;
      font-size: 10px;
      line-height: 1.5;
      letter-spacing: -0.1px;
      color: #000000;
      cursor: pointer;
    }

    .tag-button.long-tag {
      padding: 9px 24px;
    }

    .tag-button.selected {
      background-color: #0059ff;
      color: white;
      font-weight: 700;
    }

    .slider-wrapper {
      margin-top: 12px;
      padding: 0 5px;
    }

    .slider-track {
      position: relative;
      width: 100%;
      height: 4px;
      background-color: #d9d9d9;
      border-radius: 2px;
      cursor: pointer;
    }

    .slider-handle {
      position: absolute;
      top: 50%;
      left: 0%;
      transform: translate(-50%, -50%);
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background-color: #0059ff;
      cursor: pointer;
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 14px;
      letter-spacing: -0.14px;
      color: #000000;
    }

    .actions-container {
      margin-top: auto;
      padding-top: 47px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .submit-button {
      width: 100%;
      height: 55px;
      background-color: #0059ff;
      border-radius: 8px;
      border: none;
      font-weight: 700;
      font-size: 18px;
      color: #ffffff;
      cursor: pointer;
    }

    .skip-link {
      font-size: 12px;
      color: #000000;
      text-decoration: none;
    }
  </style>
</head>
<body>

<main class="preferences-container">
  <h1 class="main-title">어떤 스타일의 <br>여행을 원하시나요?</h1>

  <section class="form-section">
    <h2 class="section-title">누구와</h2>
    <div class="tags-container companion-tags">
      <button class="tag-button">혼자</button>
      <button class="tag-button">친구와</button>
      <button class="tag-button">연인과</button>
      <button class="tag-button">배우자와</button>
      <button class="tag-button">아이와</button>
      <button class="tag-button">부모님과</button>
      <button class="tag-button">반려견과</button>
    </div>
  </section>

  <section class="form-section">
    <h2 class="section-title">여행 스타일</h2>
    <div class="tags-container style-tags">
      <button class="tag-button">체험/액티비티</button>
      <button class="tag-button long-tag">SNS 핫플레이스</button>
      <button class="tag-button">자연 휴식</button>
      <button class="tag-button">유명 관광지</button>
      <button class="tag-button">힐링</button>
      <button class="tag-button">문화/예술/역사</button>
      <button class="tag-button">쇼핑</button>
      <button class="tag-button">식도락 여행</button>
    </div>
  </section>

  <section class="form-section">
    <h2 class="section-title">여행 강도</h2>
    <div class="slider-wrapper">
      <div class="slider-track" id="sliderTrack">
        <div class="slider-handle" id="sliderHandle"></div>
      </div>
      <div class="slider-labels">
        <span>Light</span>
        <span>Hard</span>
      </div>
    </div>
  </section>

  <div class="actions-container">
    <button class="submit-button" onclick="submitSelections()">완료</button>
    <a href="#" class="skip-link" id="skipLink">다음에 하기</a>
  </div>
</main>


<script>
  /////////////////////////////////////////////////////
  const urlParams = new URLSearchParams(window.location.search);
  const fromPage = urlParams.get("from");

  // 태그 버튼 토글
  const tagButtons = document.querySelectorAll('.tag-button');
  tagButtons.forEach(button => {
    button.addEventListener('click', () => {
      button.classList.toggle('selected');
    });
  });

  // 슬라이더 기능
  const sliderTrack  = document.getElementById('sliderTrack');
  const sliderHandle = document.getElementById('sliderHandle');

  // [추가] 앵커(퍼센트) & 라벨
  const ANCHORS = [0, 50, 100];
  const LABELS  = ['light', 'medium', 'hard'];

  // 현재 상태
  let sliderPercent = 50;          // 0 | 50 | 100
  let sliderCategory = 'medium';   // 'light' | 'medium' | 'hard'
  let sliderValue = 50;            // ✅ 추가: submitSelections에서 사용하는 값

  // 핸들 위치 설정
  function setHandle(pct) {
    sliderHandle.style.left = `${pct}%`;
    sliderPercent = Math.round(pct);
  }

  // 좌표 → 퍼센트
  function percentFromClientX(clientX) {
    const rect = sliderTrack.getBoundingClientRect();
    let x = clientX - rect.left;
    x = Math.max(0, Math.min(x, rect.width));
    return (x / rect.width) * 100;
  }

  // [추가] 가장 가까운 앵커로 스냅
  function snapToNearest(pct) {
    let nearestIdx = 0;
    let minDiff = Infinity;
    ANCHORS.forEach((a, i) => {
      const d = Math.abs(a - pct);
      if (d < minDiff) { minDiff = d; nearestIdx = i; }
    });
    setHandle(ANCHORS[nearestIdx]);
    sliderCategory = LABELS[nearestIdx];
    sliderValue = ANCHORS[nearestIdx];  // ✅ 추가: 현재 값 동기화
  }

  // [수정] 드래그: 이동은 자유, 마우스 업 시 스냅
  sliderHandle.addEventListener('mousedown', (e) => {
    e.preventDefault();
    const onMove = (ev) => setHandle(percentFromClientX(ev.clientX));
    const onUp   = (ev) => {
      snapToNearest(percentFromClientX(ev.clientX));
      document.removeEventListener('mousemove', onMove);
      document.removeEventListener('mouseup', onUp);
    };
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onUp);
  });

  // [추가] 트랙 클릭 시 즉시 스냅
  sliderTrack.addEventListener('click', (e) => {
    snapToNearest(percentFromClientX(e.clientX));
  });

  // [추가] 터치 지원
  sliderHandle.addEventListener('touchstart', (e) => {
    const onMove = (ev) => {
      const t = ev.touches[0];
      setHandle(percentFromClientX(t.clientX));
    };
    const onEnd = (ev) => {
      const t = (ev.changedTouches && ev.changedTouches[0]) || null;
      if (t) snapToNearest(percentFromClientX(t.clientX));
      document.removeEventListener('touchmove', onMove);
      document.removeEventListener('touchend', onEnd);
    };
    document.addEventListener('touchmove', onMove, { passive: false });
    document.addEventListener('touchend', onEnd);
  }, { passive: false });

  sliderTrack.addEventListener('touchstart', (e) => {
    const t = e.touches[0];
    snapToNearest(percentFromClientX(t.clientX));
  }, { passive: true });

  // ✅ 기존 저장값 복원 (justgoset에서 온 경우만)
  if (fromPage === "justgoset.html") {
    const savedCompanions = JSON.parse(localStorage.getItem('selectedCompanions') || "[]");
    const savedStyles = JSON.parse(localStorage.getItem('selectedStyles') || "[]");
    const savedIntensity = localStorage.getItem('travelIntensity');

    // 동반자 복원
    document.querySelectorAll('.companion-tags .tag-button').forEach(btn => {
      if (savedCompanions.includes(btn.textContent)) {
        btn.classList.add('selected');
      }
    });

    // 스타일 복원
    document.querySelectorAll('.style-tags .tag-button').forEach(btn => {
      if (savedStyles.includes(btn.textContent)) {
        btn.classList.add('selected');
      }
    });

    // 강도 복원
    if (savedIntensity !== null) {
      const percent = parseInt(savedIntensity, 10);
      sliderHandle.style.left = `${percent}%`;
      sliderValue = percent;              // ✅ 존재하던 코드, 이제 정상 동작
      sliderPercent = percent;            // (선택) 내부 상태 동기화
    }
  }

  // 완료 버튼 클릭 시
  function submitSelections() {
    const selectedCompanions = Array.from(document.querySelectorAll('.companion-tags .tag-button.selected')).map(btn => btn.textContent);
    const selectedStyles = Array.from(document.querySelectorAll('.style-tags .tag-button.selected')).map(btn => btn.textContent);

    const hasPet = selectedCompanions.includes("반려견과");

    localStorage.setItem('selectedCompanions', JSON.stringify(selectedCompanions));
    localStorage.setItem('selectedStyles', JSON.stringify(selectedStyles));
    localStorage.setItem('hasPet', hasPet.toString());
    localStorage.setItem('travelIntensity', sliderValue.toString());

    // ✅ 무조건 justgotour.html 로 이동
    window.location.href = 'justgotour.html';
  }

  // ✅ 다음에 하기 클릭 시
  document.getElementById('skipLink').addEventListener('click', function (e) {
    e.preventDefault();

    if (fromPage === "justgoset.html") {
      // 기존 값 유지
      window.location.href = 'justgoset.html';
    } else {
      // 값 삭제
      localStorage.removeItem('selectedCompanions');
      localStorage.removeItem('selectedStyles');
      localStorage.removeItem('hasPet');
      localStorage.removeItem('travelIntensity');
      window.location.href = 'justgotour.html';
    }
  });
  //////////////////////////////////////////
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ê´€ê´‘ì§€ ì¶”ì²œ</title>
  <style>
    :root {
      --text-primary: #000;
      --text-secondary: rgba(0, 0, 0, 0.5);
      --text-subtle: #828282;
      --text-white: #fff;
      --bg-main: #fff;
      --bg-light-gray: #f5f5f5;
      --border-color: #e6e6e6;
      --primary-blue: #0059ff;
    }

    body {
      margin: 0;
      font-family: 'Inter', 'Istok Web', sans-serif;
      background-color: var(--bg-main);
      color: var(--text-primary);
    }

    * {
      box-sizing: border-box;
    }

    .page-container {
      max-width: 393px;
      margin: 0 auto;
      padding: 40px 16px 180px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .main-title {
      font-weight: 700;
      font-size: 30px;
      line-height: 1.44;
      margin: 0;
    }

    .search-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: static;
      top: 0;
      background-color: white;
      z-index: 1;
    }
    .fixed-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background-color: #fff;
  z-index: 100;
  max-width: 393px;
  margin: 0 auto;
  padding: 50px 16px 16px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.listings-scroll-wrapper {
  margin-top: 220px; /* í—¤ë” ë†’ì´ë§Œí¼ ì•„ë˜ë¡œ ë°€ê¸° */
  max-height: calc(100vh - 300px);
  overflow-y: auto;
}

.select-wrapper {
  position: relative;
  display: inline-block;
}

.sort-select {
  font-size: 13px;               /* âœ… í…ìŠ¤íŠ¸ ì¡°ê¸ˆ ì‘ê²Œ */
  padding: 6px 30px 6px 12px;    /* âœ… ì˜¤ë¥¸ìª½ì€ í™”ì‚´í‘œ ì—¬ë°±, ì™¼ìª½ì€ ê¸€ì”¨ ì—¬ë°± */
  border-radius: 6px;
  border: 1px solid var(--border-color);
  appearance: none;
  background-color: white;
  background-repeat: no-repeat;
  background-position: right 10px center; /* âœ… í™”ì‚´í‘œ ìœ„ì¹˜ ì¡°ì • */
  background-size: 12px;
  text-align: left;             /* âœ… ì™¼ìª½ ì •ë ¬ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ë°°ì¹˜ */
  width: 120px;                 /* âœ… ë„¤ëª¨ ë°•ìŠ¤ ì¡°ê¸ˆ ë” ì‘ê²Œ */
}


/* í™”ì‚´í‘œ ì´ë¯¸ì§€ */
.select-arrow {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  width: 10px;
  height: 6px;
  background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%23000' stroke-width='1.5'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-size: contain;
  pointer-events: none;
}


    .search-summary {
      background-color: var(--bg-light-gray);
      border-radius: 12px;
      padding: 8px 12px;
      margin-top: 12px;
    }

    .search-title {
      font-weight: 500;
      font-size: 16px;
      margin: 0;
    }

    .search-tags {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-subtle);
    }

    .dot {
      width: 3px;
      height: 3px;
      background-color: #999;
      border-radius: 50%;
      display: inline-block;
    }

    .filter-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .filter-controls {
      display: flex;
      align-items: center;
    }

   

    .result-count {
      font-size: 14px;
    }

    .listings-container {
      display: flex;
      flex-direction: column;
      gap: 24px;
      max-height: calc(100vh - 300px);
      overflow-y: auto;
      padding-right: 4px;
    }

    .location-card {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .image-carousel {
      border-radius: 8px;
      overflow: hidden;
      height: 150px;
      background-size: cover;
      background-position: center;
    }

    .pagination-dots {
      width: 45px;
      height: 5px;
      margin-top: -16px;
    }

    .location-info {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .location-name {
      font-weight: 500;
      font-size: 14px;
      margin: 0;
    }

    .meta-info {
      display: flex;
      gap: 16px;
    }

    .rating {
      display: flex;
      gap: 4px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .price-cta {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .price-amount {
      font-weight: 500;
      font-size: 20px;
    }

    .price-unit {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .select-btn {
      background-color: var(--text-primary);
      color: var(--text-white);
      border-radius: 8px;
      padding: 6px 16px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }

    .select-btn.selected {
      background-color: var(--primary-blue);
    }

    .sticky-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      z-index: 10;
    }

    .footer-content {
      max-width: 393px;
      margin: 0 auto;
      padding: 12px 16px 37px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .main-cta-btn {
      width: 100%;
      background-color: var(--primary-blue);
      color: var(--text-white);
      font-weight: 700;
      font-size: 18px;
      padding: 14.5px 24px;
      border-radius: 8px;
      border: none; /* âœ… í…Œë‘ë¦¬ ì œê±° */
    }

    .skip-link {
      font-size: 12px;
      text-decoration: none;
      color: var(--text-primary);
    }
    
  </style>
</head>
<body>
 

  <main class="page-container">
 <div id="location-warning" style="display:none; padding: 16px; background-color: #fff3f3; border: 1px solid #ffcccc; border-radius: 8px; text-align: center; color: #cc0000;">
  <p style="margin: 0 0 8px;">âš ï¸ ì—¬í–‰ì§€ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.</p>
  <button id="go-select-location" style="padding: 8px 16px; background-color: #0059ff; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer;">
    ì—¬í–‰ì§€ ì„ íƒí•˜ëŸ¬ ê°€ê¸°
  </button>
</div>
>
  
  <div class="fixed-header">
    <h1 class="main-title">ì›í•˜ëŠ” ê´€ê´‘ì§€ë¥¼<br>ì„ íƒí•´ì£¼ì„¸ìš”.</h1>
    <div class="search-summary">
      <p class="search-title">ê´€ê´‘ì§€ ì¶”ì²œ</p>
      <div class="search-tags"></div>
    </div>
    <div class="filter-bar">
      <div class="filter-controls">
  <div class="select-wrapper">
    <select class="sort-select">
      <option value="review">ë¦¬ë·° ë§ì€ ìˆœ</option>
      <option value="rating">ë³„ì  ë†’ì€ ìˆœ</option>
    </select>
    <span class="select-arrow"></span>
  </div>
</div>

      <p class="result-count">ê²°ê³¼ 0ê°œ</p>
    </div>
  </div>

  <div class="listings-scroll-wrapper">
    <section class="listings-container">
      <!-- ê´€ê´‘ì§€ ì¹´ë“œ -->
    </section>
  </div>
</main>


  <footer class="sticky-footer">
    <div class="footer-content">
     <button class="main-cta-btn" onclick="handleComplete()">ì™„ë£Œ</button>

      <a href="#" class="skip-link">ë‹¤ìŒì— í•˜ê¸°</a>
    </div>
  </footer>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
const fromPage = urlParams.get("from");

    let places = [];

    const tagContainer = document.querySelector(".search-tags");
    const titleElem = document.querySelector(".search-title");
    const resultCount = document.querySelector(".result-count");
    const container = document.querySelector(".listings-container");
    const sortSelect = document.querySelector(".sort-select");

 window.addEventListener('DOMContentLoaded', () => {
  const skip = localStorage.getItem("skipRecommendation") === "true";

  const warningBox = document.getElementById("location-warning");
  const fixedHeader = document.querySelector(".fixed-header");
  const scrollWrapper = document.querySelector(".listings-scroll-wrapper");
  const footer = document.querySelector("footer");

  const location = localStorage.getItem("selectedLocation");

  if (!location || location === "ì—¬í–‰ì§€") {
    // ğŸš¨ ì—¬í–‰ì§€ ë¯¸ì…ë ¥ â†’ ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
    warningBox.style.display = "block";
    fixedHeader.style.display = "none";
    scrollWrapper.style.display = "none";
    footer.style.display = "none";
    return;
  }

  // âœ… ì—¬í–‰ì§€ ì…ë ¥ë¨ â†’ ê¸°ë³¸ UI í‘œì‹œ
  warningBox.style.display = "none";
  fixedHeader.style.display = "block";
  scrollWrapper.style.display = "block";
  footer.style.display = "block";

  if (skip) {
    // ğŸ‘‰ ë‹¤ìŒì— í•˜ê¸° ì„ íƒí•œ ê²½ìš°
    titleElem.innerText = `ê´€ê´‘ì§€ ì¶”ì²œ`;
    tagContainer.innerHTML = "";
    resultCount.innerText = "ê²°ê³¼ 0ê°œ";
    container.innerHTML = "";
    localStorage.removeItem("skipRecommendation");
    return;
  }

  // âœ… ì…ë ¥ ì •ë³´ ì²˜ë¦¬
  const dateRange = JSON.parse(localStorage.getItem("selectedDates") || "[]");
  let companions = JSON.parse(localStorage.getItem("selectedCompanions") || "[]");
  const hasPet = localStorage.getItem("hasPet") === "true" ? "ë°˜ë ¤ê²¬ O" : "ë°˜ë ¤ê²¬ X";
  const styles = JSON.parse(localStorage.getItem("selectedStyles") || "[]");

  titleElem.innerText = `${location} ê´€ê´‘ì§€ ì¶”ì²œ`;

  const tagParts = [];

  // ë‚ ì§œ íƒœê·¸
  if (dateRange.length === 2) {
    const s = new Date(dateRange[0]);
    const e = new Date(dateRange[1]);
    tagParts.push(`${s.getMonth() + 1}ì›” ${s.getDate()}ì¼ ~ ${e.getMonth() + 1}ì›” ${e.getDate()}ì¼`);
  }

  // ë™ë°˜ì
  companions = companions.filter(c => c !== "ë°˜ë ¤ê²¬ê³¼");
  if (companions.length > 0) {
    tagParts.push(companions.join(", "));
  }

  // ë°˜ë ¤ê²¬
  tagParts.push(hasPet);

  // ìŠ¤íƒ€ì¼
  if (styles.length > 0) {
    tagParts.push(styles.join(", "));
  }

  // íƒœê·¸ ë Œë”ë§
  if (tagParts.length > 0) {
    tagContainer.innerHTML = tagParts.map((t, i) => {
      const dot = i < tagParts.length - 1 ? `<span class="dot"></span>` : "";
      return `<span>${t}</span>${dot}`;
    }).join("");
  } else {
    tagContainer.innerHTML = ""; // ì•„ë¬´ íƒœê·¸ë„ ì—†ìœ¼ë©´ ë¹„ìš°ê¸°
  }

  fetchRecommendedPlaces(); // ê´€ê´‘ì§€ ì¹´ë“œ ë Œë”ë§
});



document.getElementById("go-select-location").addEventListener("click", () => {
  // ì—¬í–‰ì§€ ì„ íƒ í˜ì´ì§€ë¡œ ì´ë™ (ì˜ˆ: justgolocation.html)
  location.href = "justgowhere.html";
});




   function fetchRecommendedPlaces() {
  fetch('http://localhost:8000/api/recommend/attractions', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      destination: localStorage.getItem("selectedLocation"),
      dates: JSON.parse(localStorage.getItem("selectedDates") || "[]"),
      companions: JSON.parse(localStorage.getItem("selectedCompanions") || "[]"),
      styles: JSON.parse(localStorage.getItem("selectedStyles") || "[]"),
      hasPet: localStorage.getItem("hasPet") === "true",
    })
  })
  .then(response => response.json())
  .then(data => {
    places = data.places; // ğŸ”„ ë°±ì—”ë“œì—ì„œ ë°›ì•„ì˜¨ ì¥ì†Œ ë¦¬ìŠ¤íŠ¸ ì €ì¥
    renderPlaceCards();   // ğŸ” ì¹´ë“œ ë Œë”ë§ í•¨ìˆ˜ ì‹¤í–‰
  })
  .catch(error => {
    console.error("ê´€ê´‘ì§€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
  });
}


    function renderPlaceCards() {
      container.innerHTML = "";

      // ì •ë ¬
      const sortType = sortSelect.value;
      const sorted = [...places];
      if (sortType === "review") {
        sorted.sort((a, b) => b.reviewCount - a.reviewCount);
      } else {
        sorted.sort((a, b) => b.rating - a.rating);
      }

      resultCount.innerText = `ê²°ê³¼ ${sorted.length}ê°œ`;

      sorted.forEach(place => {
        const card = document.createElement("article");
        card.className = "location-card";
        card.innerHTML = `
          <div class="image-carousel" style="background-image: url('${place.imageUrl}')"></div>
          <div class="location-info">
            <p class="location-name">${place.name}</p>
            <div class="meta-info">
              <div class="rating">
                <span>â­</span>
                <span>${place.rating} (${place.reviewCount}ê°œ)</span>
              </div>
            </div>
            <div class="price-cta">
              <div>
                <span class="price-amount">â‚©${place.price}</span>
                <span class="price-unit">/1ì¸</span>
              </div>
              <button class="select-btn">ì„ íƒ</button>
            </div>
          </div>
        `;
        container.appendChild(card);
      });

      document.querySelectorAll(".select-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          btn.classList.toggle("selected");
          btn.textContent = btn.classList.contains("selected") ? "ì„ íƒë¨" : "ì„ íƒ";
        });
      });
    }
    document.querySelector(".skip-link").addEventListener("click", () => {
  localStorage.setItem("skipRecommendation", "true"); // ğŸš¨ ë‹¤ìŒ í˜ì´ì§€ì—ì„œ ì°¸ê³ í•  í”Œë˜ê·¸
  location.href = "justgorecommend.html"; // ì¶”ì²œ í™”ë©´ ê²½ë¡œ
});


    // ì •ë ¬ ì„ íƒ ë³€ê²½ ì‹œ ë‹¤ì‹œ ë Œë”ë§
    sortSelect.addEventListener("change", renderPlaceCards);
    // "ë‹¤ìŒì— í•˜ê¸°" ë²„íŠ¼ (ì„ íƒí™”ë©´)
document.querySelector("#main-section .skip-link").addEventListener("click", () => {
  localStorage.removeItem("selectedLocation");
  localStorage.removeItem("selectedDates");
  localStorage.removeItem("selectedCompanions");
  localStorage.removeItem("hasPet");
  localStorage.removeItem("selectedStyles");
  localStorage.setItem("skipRecommendation", "true");
  location.href = "justgocalendar.html";
});

// "ë‹¤ìŒì— í•˜ê¸°" ë²„íŠ¼ (ì§ì ‘ì…ë ¥í™”ë©´)
document.querySelector("#destination-screen .link-skip").addEventListener("click", () => {
  localStorage.removeItem("selectedLocation");
  localStorage.removeItem("selectedDates");
  localStorage.removeItem("selectedCompanions");
  localStorage.removeItem("hasPet");
  localStorage.removeItem("selectedStyles");
  localStorage.setItem("skipRecommendation", "true");
  location.href = "justgocalendar.html";
});
document.getElementById("go-select-location").addEventListener("click", () => {
  location.href = "justgolocation.html"; // ì‹¤ì œ ì—¬í–‰ì§€ ì„ íƒ í˜ì´ì§€ ê²½ë¡œë¡œ ìˆ˜ì •
});
window.addEventListener("DOMContentLoaded", () => {
  const generateBtn = document.getElementById("generate-btn");

  const destination = localStorage.getItem("selectedLocation");
  const dates = JSON.parse(localStorage.getItem("selectedDates") || "[]");

  // ì—¬í–‰ì§€ë‚˜ ë‚ ì§œê°€ ì—†ìœ¼ë©´ ë²„íŠ¼ ìˆ¨ê¹€
  if (!destination || dates.length !== 2) {
    generateBtn.style.display = "none";
  } else {
    generateBtn.style.display = "block";
  }
});
function handleComplete() {
  // 1. ì„ íƒëœ ê´€ê´‘ì§€ ëª©ë¡ ìˆ˜ì§‘
  const selectedPlaces = [];
  document.querySelectorAll(".location-card").forEach(card => {
    const selectBtn = card.querySelector(".select-btn");
    if (selectBtn.classList.contains("selected")) {
      const placeName = card.querySelector(".location-name").textContent;
      selectedPlaces.push(placeName);
    }
  });

  // 2. localStorageì— ì €ì¥
  localStorage.setItem("selectedAttractions", JSON.stringify(selectedPlaces));

  // 3. í˜ì´ì§€ ì´ë™
  const fromPage = new URLSearchParams(window.location.search).get("from");
  if (fromPage === "justgoset.html") {
    location.href = "justgoset.html";
  } else {
    location.href = "justgofood.html";
  }
}

document.querySelector(".skip-link").addEventListener("click", () => {
  localStorage.setItem("skipRecommendation", "true");
  const fromPage = new URLSearchParams(window.location.search).get("from");

  if (fromPage === "justgoset.html") {
    location.href = "justgoset.html";
  } else {
    location.href = "justgofood.html";
  }
});


  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>날짜 선택</title>

  <!-- Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    body {
      font-family: 'Istok Web', sans-serif;
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      color: #000000;
    }
    * { box-sizing: border-box; }
    a { text-decoration: none; color: inherit; }
/*** @어쩌구도 지움*/
    /* ===== 여행지 선택 페이지와 동일한 컨테이너 규격 ===== */
  /************************************************************/
    .container {
  position: relative;        /* 절대좌표 기준 */
  background-color: #ffffff;
  width: 393px;              /* 고정 */
  height: 787px;             /* 고정 (원하면 680~820로 조절) */
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  padding: 72px 16px 43px;
}
/******************************************************/

    .title {
      font-weight: 700;
      font-size: 30px;
      line-height: 1.44;
      color: #000000;
      margin: 0;
      text-align: left;
    }

    /* ===== 페이지 섹션 구조 ===== */
    #date-section { width: 100%; display: flex; justify-content: center; }
    #date-section .page-header { flex-shrink: 0; }

    /* 본문은 같은 상단 간격(46px) + 가운데 배치 */
    #date-section .content {
      margin-top: -300px;     /* 여행지 페이지와 동일 */
      flex-grow: 1;
      display: grid;
      place-items: center;  /* 캘린더 중앙 */
    }

    /* 푸터는 동일하게 아래로 붙고 가운데 정렬 + 여유 여백 */
    #date-section .page-footer {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex-shrink: 0;
      margin-bottom: 72px;  /* 여행지 페이지 footer와 동일 */
    }

    .btn-primary {
      background-color: #0059ff;
      border-radius: 8px;
      color: #ffffff;
      font-weight: 700;
      font-size: 18px;
      height: 55px;
      width: 100%;
      border: none;
      cursor: pointer;
    }
    .btn-primary:hover { background-color: #0045c7; }
    .skip-link { font-size: 12px; margin-top: 12px; }

    /* ===== Flatpickr 레이아웃을 컨테이너에 맞춤 ===== */
    #calendar { width: fit-content; margin: 0 auto; }
    .flatpickr-calendar.inline {
      width: auto !important;
      max-width: 100%;
      margin: 0 auto;
      font-size: 19px; /* 살짝 키움 */
    }
    .flatpickr-day { height: 41px; line-height: 41px; max-width: 41px; }

   
   /* 🔼 Flatpickr 헤더(년도/월) 살짝 키움 */
.flatpickr-months .flatpickr-current-month { 
  font-size: 18px !important;
  line-height: 1.25;
}

.flatpickr-current-month .cur-month {
  font-size: 18px !important;
}

.flatpickr-current-month input.cur-year {
  font-size: 18px !important;
  height: 1.4em;    /* 세로 정렬 보정 */
  padding: 0 2px;   /* 좌우 여백 살짝 */
}

.flatpickr-monthDropdown-months {
  font-size: 18px !important;
}
/**************************************************************/
/* 완료 버튼: 절대좌표 + 글자 정중앙 */
#date-section .btn-primary {
  position: absolute;
  left: 16px;
  top: 652.5px;     /* 더 내리고 싶으면 키워도 됨 (예: 670px) */
  width: 361px;     /* 393 - 16*2 */
  height: 55px;

  display: flex;            /* 글자 가로/세로 중앙 정렬 */
  justify-content: center;
  align-items: center;
}

/* "다음에 하기" 링크: 가로 정확히 중앙 */
#date-section .skip-link {
  position: absolute;
  top: 707.5px;     /* 완료 버튼과 간격 맞춤. 필요시 조절 */
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
}
/*******************************************************/
  </style>
</head>
<body>
  <section id="date-section">
    <div class="container">
      <header class="page-header">
        <h1 class="title">언제 떠나시나요?</h1>
      </header>

      <main class="content">
        <div id="calendar"></div>
      </main>

      <footer class="page-footer">
        <button class="btn-primary" id="submit-btn">완료</button>
        <a href="#" class="skip-link" id="skip-link">다음에 하기</a>
      </footer>
    </div>
  </section>

  <!-- Flatpickr JS & 한국어 로케일 -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>

 <script>
  // ---- 유틸: 로컬 yyyy-mm-dd ----
  function fmtYmdLocal(d){
    const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }
  function atNoon(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate(), 12, 0, 0, 0); }

  const params   = new URLSearchParams(location.search);
  const fromPage = params.get("from");

  // ✅ 저장된 날짜(있으면 불러옴) — 제출 핸들러에서 fallback으로만 사용
  const savedDates = JSON.parse(localStorage.getItem("selectedDates") || "[]");

  // ✅ flatpickr는 한 번만 초기화 + defaultDate(조건부)
  const fp = flatpickr("#calendar", {
    mode: "range",
    dateFormat: "Y-m-d",
    minDate: "today",
    inline: true,
    locale: "ko",
    defaultDate: (fromPage === "justgoset.html" && savedDates.length === 2) ? savedDates : null
    // onChange 없어도 됨. 제출 시 fp.selectedDates에서 직접 읽음
  });

  // ✅ 완료
  document.getElementById("submit-btn").addEventListener("click", () => {
    // 항상 인스턴스에서 최신 선택값을 읽음
    const picked = fp.selectedDates.map(fmtYmdLocal);

    // 새 선택값이 2개면 그것을, 아니면 (set에서 복귀 시) savedDates를 사용
    const toSave =
      (picked.length === 2) ? picked :
      ((fromPage === "justgoset.html" && savedDates.length === 2) ? savedDates : []);

    if (toSave.length !== 2) {
      alert("시작과 종료 날짜를 모두 선택해주세요.");
      return;
    }

    // 일수 계산(로컬 정오 기준)
    const [sy, sm, sd] = toSave[0].split("-").map(Number);
    const [ey, em, ed] = toSave[1].split("-").map(Number);
    const start = atNoon(new Date(sy, sm-1, sd));
    const end   = atNoon(new Date(ey, em-1, ed));
    const days  = Math.round((end - start)/86400000) + 1;

    localStorage.setItem("selectedDates", JSON.stringify(toSave));
    localStorage.setItem("travelDays", String(days));

    location.href = (fromPage === "justgoset.html") ? "justgoset.html" : "justgomoney.html";
  });

  // ✅ 다음에 하기
  document.getElementById("skip-link").addEventListener("click", (e) => {
    e.preventDefault();
    if (fromPage === "justgoset.html") {
      // 값 유지
      localStorage.setItem("skipRecommendation", "true");
      location.href = "justgoset.html";
    } else {
      // 값 삭제
      localStorage.removeItem("selectedDates");
      localStorage.setItem("skipRecommendation", "true");
      location.href = "justgomoney.html";
    }
  });
</script>

</body>
</html>

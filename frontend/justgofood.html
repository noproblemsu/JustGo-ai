<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>JustGo 근처 맛집 추천</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="./style.css">
  <style>
    .place-card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:12px;margin:10px 0;}
    .place-title{font-weight:700;margin-bottom:6px}
    .btn{border:1px solid #0055ff;padding:10px 14px;border-radius:10px;background:#eef3ff;cursor:pointer}
    img{border-radius:8px;max-width:100%}
  </style>
</head>
<body>
  <main style="max-width:680px;margin:24px auto;padding:0 16px;">
    <h1>🍜 근처 맛집 추천</h1>

    <section style="display:flex;gap:8px;align-items:center;">
      <input id="recommendQuery" placeholder="예: 2일차 점심 일식" style="flex:1;padding:10px">
      <button id="recommendPlacesBtn" class="btn">추천 받기</button>
    </section>

    <small style="display:block;margin:8px 0;color:#666;">※ 직전 생성된 일정의 첫 장소 기준으로 반경 5km 내 랭킹 추천</small>

    <section id="recommendPlacesResult"></section>
  </main>

  <script type="module">
    import { apiRecommendPlaces } from "./js/api.js";

    const $btn = document.getElementById("recommendPlacesBtn");
    const $out = document.getElementById("recommendPlacesResult");
    const $query = document.getElementById("recommendQuery");

    $btn?.addEventListener("click", async ()=>{
      try{
        $btn.disabled = true;

        const destination = localStorage.getItem("selectedLocation") || "";
        const dates = JSON.parse(localStorage.getItem("selectedDates") || "[]");
        const base_point = JSON.parse(localStorage.getItem("lastBasePoint") || "null");

        if(!destination){ alert("먼저 일정 생성 페이지에서 여행지를 설정하세요."); $btn.disabled=false; return; }

        const data = await apiRecommendPlaces({
          destination,
          dates,
          base_point,                     // 없으면 서버가 도시 중심으로 처리
          query: $query.value.trim() || `${destination} 맛집`
        });

        $out.innerHTML = data.places.length
          ? data.places.map(p => `
              <div class="place-card">
                <div class="place-title"><a href="${p.naver_url||'#'}" target="_blank">${p.name}</a></div>
                ${p.image_url ? `<img src="${p.image_url}" alt="${p.name}">` : ""}
                <div class="place-meta" style="color:#333;font-size:14px;line-height:1.6;">
                  ${p.address ? `주소: ${p.address}<br>` : ""}
                  ${p.distance_km != null ? `거리: ${p.distance_km}km<br>` : ""}
                  ${p.score != null ? `점수: ${p.score}<br>` : ""}
                </div>
              </div>
            `).join("")
          : `<div>추천 결과가 비어있어요.</div>`;
      }catch(err){
        console.error(err);
        $out.innerHTML = `<div style="color:#c00;">요청 실패: ${err.message}</div>`;
      }finally{
        $btn.disabled = false;
      }
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>JustGo ê·¼ì²˜ ë§›ì§‘ ì¶”ì²œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="./style.css">
  <style>
    .place-card{background:#fff;border:1px solid #e6e6e6;border-radius:12px;padding:12px;margin:10px 0;}
    .place-title{font-weight:700;margin-bottom:6px}
    .btn{border:1px solid #0055ff;padding:10px 14px;border-radius:10px;background:#eef3ff;cursor:pointer}
    img{border-radius:8px;max-width:100%}
  </style>
</head>
<body>
  <main style="max-width:680px;margin:24px auto;padding:0 16px;">
    <h1>ğŸœ ê·¼ì²˜ ë§›ì§‘ ì¶”ì²œ</h1>

    <section style="display:flex;gap:8px;align-items:center;">
      <input id="recommendQuery" placeholder="ì˜ˆ: 2ì¼ì°¨ ì ì‹¬ ì¼ì‹" style="flex:1;padding:10px">
      <button id="recommendPlacesBtn" class="btn">ì¶”ì²œ ë°›ê¸°</button>
    </section>

    <small style="display:block;margin:8px 0;color:#666;">â€» ì§ì „ ìƒì„±ëœ ì¼ì •ì˜ ì²« ì¥ì†Œ ê¸°ì¤€ìœ¼ë¡œ ë°˜ê²½ 5km ë‚´ ë­í‚¹ ì¶”ì²œ</small>

    <section id="recommendPlacesResult"></section>
  </main>

  <script type="module">
    import { apiRecommendPlaces } from "./js/api.js";

    const $btn = document.getElementById("recommendPlacesBtn");
    const $out = document.getElementById("recommendPlacesResult");
    const $query = document.getElementById("recommendQuery");

    $btn?.addEventListener("click", async ()=>{
      try{
        $btn.disabled = true;

        const destination = localStorage.getItem("selectedLocation") || "";
        const dates = JSON.parse(localStorage.getItem("selectedDates") || "[]");
        const base_point = JSON.parse(localStorage.getItem("lastBasePoint") || "null");

        if(!destination){ alert("ë¨¼ì € ì¼ì • ìƒì„± í˜ì´ì§€ì—ì„œ ì—¬í–‰ì§€ë¥¼ ì„¤ì •í•˜ì„¸ìš”."); $btn.disabled=false; return; }

        const data = await apiRecommendPlaces({
          destination,
          dates,
          base_point,                     // ì—†ìœ¼ë©´ ì„œë²„ê°€ ë„ì‹œ ì¤‘ì‹¬ìœ¼ë¡œ ì²˜ë¦¬
          query: $query.value.trim() || `${destination} ë§›ì§‘`
        });

        $out.innerHTML = data.places.length
          ? data.places.map(p => `
              <div class="place-card">
                <div class="place-title"><a href="${p.naver_url||'#'}" target="_blank">${p.name}</a></div>
                ${p.image_url ? `<img src="${p.image_url}" alt="${p.name}">` : ""}
                <div class="place-meta" style="color:#333;font-size:14px;line-height:1.6;">
                  ${p.address ? `ì£¼ì†Œ: ${p.address}<br>` : ""}
                  ${p.distance_km != null ? `ê±°ë¦¬: ${p.distance_km}km<br>` : ""}
                  ${p.score != null ? `ì ìˆ˜: ${p.score}<br>` : ""}
                </div>
              </div>
            `).join("")
          : `<div>ì¶”ì²œ ê²°ê³¼ê°€ ë¹„ì–´ìˆì–´ìš”.</div>`;
      }catch(err){
        console.error(err);
        $out.innerHTML = `<div style="color:#c00;">ìš”ì²­ ì‹¤íŒ¨: ${err.message}</div>`;
      }finally{
        $btn.disabled = false;
      }
    });
  </script>
</body>
</html>
